<div class="px-[2rem] table-wrapper">
  <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
  
    <ng-container *ngFor="let col of columns" [matColumnDef]="col.property">
      <th mat-header-cell *matHeaderCellDef 
          [class.sortable]="isSortable(col.property)"
          (click)="isSortable(col.property) ? toggleSort(col.property) : null">
        <div class="header-content">
          <span>{{col.label}}</span>
          <span class="sort-indicator" *ngIf="isSortable(col.property)">
            <span *ngIf="sortColumn === col.property && sortDirection === 'asc'">▲</span>
            <span *ngIf="sortColumn === col.property && sortDirection === 'desc'">▼</span>
            <span *ngIf="sortColumn !== col.property" class="sort-inactive">⇅</span>
          </span>
        </div>
      </th>
      <td mat-cell *matCellDef="let element"> 
        <ng-container *ngIf="col.property==='sendedSalesForce'">
          <span class="status-badge" [ngClass]="cellValue(element, col.property) === '1' ? 'sent' : 'not-sent'">
            <span class="material-symbols-outlined">
              {{ cellValue(element, col.property) === '1' ? 'send' : 'cancel_schedule_send' }}
            </span>
          </span>
        </ng-container>
        <ng-container *ngIf="col.type === 'button' &&col.property==='actions'">
          <button class="btn-info" (click)="openModal(element)">
            <span class="material-symbols-outlined">
              visibility
            </span>
          </button>
        </ng-container>
        <ng-container *ngIf="col.property === 'sf_jsonRequest' && col.type === 'button'">
          <button class="btn-json" (click)="openJsonModal(element)">
            <svg xmlns="http://www.w3.org/2000/svg" height="25px" viewBox="0 -960 960 960" width="40px" fill="#FF5C20"><path d="M320-213.33q-27 0-46.83-19.84Q253.33-253 253.33-280v-533.33q0-27 19.84-46.84Q293-880 320-880h413.33q27 0 46.84 19.83Q800-840.33 800-813.33V-280q0 27-19.83 46.83-19.84 19.84-46.84 19.84H320Zm0-66.67h413.33v-533.33H320V-280ZM186.67-80q-27 0-46.84-19.83Q120-119.67 120-146.67v-600h66.67v600h480V-80h-480ZM320-280v-533.33V-280Z"/></svg>
          </button>
        </ng-container>
        <ng-container *ngIf="col.property === 'sf_link' && col.type === 'button'">
          <button 
            class="btn-sf-link" 
            [disabled]="!isSalesForceAvailable(element)"
            (click)="openSalesForceLink(element)"
            [title]="isSalesForceAvailable(element) ? 'Ver en Salesforce' : 'No disponible en Salesforce'">
            <span class="material-symbols-outlined">
              open_in_new
            </span>
          </button>
        </ng-container>
        <ng-container *ngIf="col.property === 'resend' && col.type === 'button'">
          <button 
            class="btn-resend"
            [disabled]="!isSendAvailable(element)" 
            (click)="onResend ? onResend(element) : null"
            [title]="isSendAvailable(element) ? 'Reenviar a Salesforce' : 'Reenvío no disponible'">
            <span class="material-symbols-outlined">
              refresh
            </span>
          </button>
        </ng-container>
        <ng-container *ngIf="col.property === 'resultSF'">
          <span class="status-badge" 
                [ngClass]="getResultSFStatus(element)"
                [title]="cellValue(element, col.property)"
                [style.cursor]="getResultSFStatus(element) === 'error' ? 'pointer' : 'default'"
                (click)="getResultSFStatus(element) === 'error' && copyErrorToClipboard(element)">
            <span class="material-symbols-outlined">
              {{ getResultSFStatus(element) === 'success' ? 'check_circle' : (getResultSFStatus(element) === 'warning' ? 'warning' : 'error') }}
            </span>
          </span>
        </ng-container>
        <ng-container *ngIf="col.property === 'updateStatus'">
          <span class="update-status-icon" [style.color]="getUpdateStatusColor(element)">
            <span class="material-symbols-outlined">
              nest_clock_farsight_analog
            </span>
          </span>
        </ng-container>
        <ng-container *ngIf="col.property === 'OemLeadId'">
          <span class="truncated-text" [title]="cellValue(element, col.property)">
            {{ cellValue(element, col.property) }}
          </span>
        </ng-container>
        <ng-container *ngIf="col.type !== 'button' && col.property !== 'sendedSalesForce' && col.property !== 'resultSF' && col.property !== 'updateStatus' && col.property !== 'OemLeadId'">
          {{ cellValue(element, col.property) }}
        </ng-container>
      </td>
    </ng-container>
  
    <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-black text-white"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="onRow ? onRow(row) : null"></tr>
  
  </table>

  <!-- Mensaje de no datos encontrados -->
  <div *ngIf="(!data || data.length === 0) && hasActiveFilters" class="no-data-message">
    <div class="no-data-content">
      <span class="material-symbols-outlined no-data-icon">
        search_off
      </span>
      <h3 class="no-data-title">No se encontraron datos</h3>
      <p class="no-data-subtitle">
        No hay registros que coincidan con los filtros aplicados.
        <br>Intenta modificar los criterios de búsqueda.
      </p>
    </div>
  </div>
  
  <!-- Paginación personalizada -->
  <div class="custom-pagination" *ngIf="total && total > 0">
    <div class="pagination-info">
      <div class="records-per-page">
        <label for="pageSize">Mostrar:</label>
        <select 
          id="pageSize" 
          [ngModel]="pageSize" 
          (ngModelChange)="onPageSizeChange($event)"
          class="page-size-select">
          <option *ngFor="let option of pageSizeOptions" [value]="option">
            {{ option }}
          </option>
        </select>
        <span>registros por página</span>
      </div>
      <div class="showing-info">
        Mostrando {{ (currentPage * pageSize) + 1 }} - {{ Math.min((currentPage + 1) * pageSize, total) }} de {{ total }} registros
      </div>
    </div>
    
    <div class="pagination-controls">
      <button 
        class="pagination-btn" 
        [disabled]="!canGoPrevious"
        (click)="goToFirstPage()"
        title="Primera página">
        ««
      </button>
      
      <button 
        class="pagination-btn" 
        [disabled]="!canGoPrevious"
        (click)="goToPreviousPage()"
        title="Página anterior">
        ‹
      </button>
      
      <span class="page-indicator">
        Página {{ currentPage + 1 }} de {{ totalPages }}
      </span>
      
      <button 
        class="pagination-btn" 
        [disabled]="!canGoNext"
        (click)="goToNextPage()"
        title="Página siguiente">
        ›
      </button>
      
      <button 
        class="pagination-btn" 
        [disabled]="!canGoNext"
        (click)="goToLastPage()"
        title="Última página">
        »»
      </button>
    </div>
  </div>
</div>
