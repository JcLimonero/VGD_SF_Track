<div class="filter-bar-wrapper px-[5rem] py-5">
  <form [formGroup]="filterForm" (ngSubmit)="onFilter()" >
    <div class="filter-bar">
        <div class="filter-field">
          <label for="order_dms">No.Orden</label>
          <input
            id="order_dms"
            type="text"
            placeholder="Número de orden"
            formControlName="order_dms"
          />
        </div>
        <div class="filter-field">
          <label for="vin">VIN</label>
          <input
            id="vin"
            type="text"
            placeholder="VIN"
            formControlName="vin"
          />
        </div>
        <div class="filter-field">
          <label for="reference">No.Factura</label>
          <input
            id="reference"
            type="text"
            placeholder="Número de factura"
            formControlName="reference"
          />
        </div>

        <!-- Dropdown: Agencias -->
        <details class="dropdown">
          <summary class="dropdown-trigger">
            {{ selectedAgency || 'Agencia' }} 
            <span class="material-symbols-outlined">keyboard_arrow_down</span>
          </summary>
          <div class="dropdown-panel">
            <label class="checkbox" *ngFor="let agency of agencies">
              <input 
                type="checkbox"
                [checked]="selectedAgency === agency.name"
                (change)="onAgencySelect(agency.name, $event); closeDropdown($event)" />
              {{ agency.name }}
            </label>
          </div>
        </details>

        <!-- Dropdown: Salesforce status -->
        <details class="dropdown">
          <summary class="dropdown-trigger">Salesforce <span class="material-symbols-outlined">keyboard_arrow_down</span>
          </summary>
          <div class="dropdown-panel">
            <label class="checkbox">
                <input id="enviadoSF" type="checkbox"
                  [checked]="filterForm.get('sendedSalesForce')?.value === '1'"
                  (change)="onSfToggle('1', $event); closeDropdown($event)" />
              Enviado
            </label>
            <label class="checkbox">
                <input id="noenviadoSF" type="checkbox"
                  [checked]="filterForm.get('sendedSalesForce')?.value === '0'"
                  (change)="onSfToggle('0', $event); closeDropdown($event)" />
              No enviado
            </label>
          </div>
        </details>

        <!-- Dropdown: Inserción status -->
        <details class="dropdown">
          <summary class="dropdown-trigger">Estado SF<span class="material-symbols-outlined">keyboard_arrow_down</span>
          </summary>
          <div class="dropdown-panel">
            <label class="checkbox">
              <input
                id="insertado"
                type="checkbox"
                formControlName="insertado"
                (change)="onInsertToggle('insertado', $event); closeDropdown($event)"
              />
              Insertado
            </label>
            <label class="checkbox">
              <input
                id="error"
                type="checkbox"
                formControlName="error"
                (change)="onInsertToggle('error', $event); closeDropdown($event)"
              />
              Error
            </label>
          </div>
        </details>

        <button type="submit" class="filter-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
      </button>
      <!-- Botón de Excel (icono) -->
      <button
        type="button"
        class="excel-icon-btn"
        (click)="downloadRequested.emit()"
        [disabled]="isDownloadingExcel"
        aria-label="Descargar Excel"
        title="Descargar Excel"
      >
        <!-- Icono de Excel auténtico -->
        <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <!-- Fondo verde de Excel -->
          <rect x="3" y="3" width="18" height="18" rx="2" fill="#107C41"/>
          <!-- Letra X blanca -->
          <path d="M8 8l3 4-3 4" stroke="#fff" stroke-width="1.5" stroke-linecap="round" fill="none"/>
          <path d="M16 8l-3 4 3 4" stroke="#fff" stroke-width="1.5" stroke-linecap="round" fill="none"/>
          <!-- Borde blanco sutil -->
          <rect x="3" y="3" width="18" height="18" rx="2" fill="none" stroke="#fff" stroke-width="0.5" opacity="0.3"/>
        </svg>
      </button>
    </div>
  </form>
</div>
