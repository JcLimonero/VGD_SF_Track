<div class="filter-bar-wrapper px-[2rem] py-5">
  <form [formGroup]="filterForm" (ngSubmit)="onFilter()" >
    <div class="filter-bar">

    <!-- Dropdown: Agencias -->
        <details class="dropdown">
          <summary class="dropdown-trigger">
            {{ selectedAgency || 'Agencia' }} 
            <span class="material-symbols-outlined">keyboard_arrow_down</span>
          </summary>
          <div class="dropdown-panel">
            <label class="checkbox" *ngFor="let agency of agencies">
              <input 
                type="checkbox"
                [checked]="selectedAgency === agency.name"
                (change)="onAgencySelect(agency, $event); closeDropdown($event)" />
              {{ agency.name }}
            </label>
          </div>
        </details>

    <!-- Dropdown: Tipo -->
        <details class="dropdown">
          <summary class="dropdown-trigger">
            {{ selectedType || 'Tipo' }}
            <span class="material-symbols-outlined">keyboard_arrow_down</span>
          </summary>
          <div class="dropdown-panel">
            <label class="checkbox">
              <input 
                type="checkbox"
                [checked]="filterForm.get('type')?.value === 'ServicesByVin'"
                (change)="onTypeToggle('ServicesByVin', $event); closeDropdown($event)" />
              ServicesByVin
            </label>
            <label class="checkbox">
              <input 
                type="checkbox"
                [checked]="filterForm.get('type')?.value === 'Orders'"
                (change)="onTypeToggle('Orders', $event); closeDropdown($event)" />
              Orders
            </label>
            <label class="checkbox">
              <input 
                type="checkbox"
                [checked]="filterForm.get('type')?.value === 'Spares'"
                (change)="onTypeToggle('Spares', $event); closeDropdown($event)" />
              Spares
            </label>
            <label class="checkbox">
              <input 
                type="checkbox"
                [checked]="filterForm.get('type')?.value === 'LastCustomerSeller'"
                (change)="onTypeToggle('LastCustomerSeller', $event); closeDropdown($event)" />
              LastCustomerSeller
            </label>
            <label class="checkbox">
              <input 
                type="checkbox"
                [checked]="filterForm.get('type')?.value === 'Comissions'"
                (change)="onTypeToggle('Comissions', $event); closeDropdown($event)" />
              Comissions
            </label>
            <label class="checkbox">
              <input 
                type="checkbox"
                [checked]="filterForm.get('type')?.value === 'Inventory'"
                (change)="onTypeToggle('Inventory', $event); closeDropdown($event)" />
              Inventory
            </label>
            <label class="checkbox">
              <input 
                type="checkbox"
                [checked]="filterForm.get('type')?.value === 'Invoices'"
                (change)="onTypeToggle('Invoices', $event); closeDropdown($event)" />
              Invoices
            </label>
            <label class="checkbox">
              <input 
                type="checkbox"
                [checked]="filterForm.get('type')?.value === 'Services'"
                (change)="onTypeToggle('Services', $event); closeDropdown($event)" />
              Services
            </label>
            <label class="checkbox">
              <input 
                type="checkbox"
                [checked]="filterForm.get('type')?.value === 'Customers'"
                (change)="onTypeToggle('Customers', $event); closeDropdown($event)" />
              Customers
            </label>
            <label class="checkbox">
              <input 
                type="checkbox"
                [checked]="filterForm.get('type')?.value === 'CustomersVehicle'"
                (change)="onTypeToggle('CustomersVehicle', $event); closeDropdown($event)" />
              CustomersVehicle
            </label>
            <label class="checkbox">
              <input 
                type="checkbox"
                [checked]="filterForm.get('type')?.value === 'Lead'"
                (change)="onTypeToggle('Lead', $event); closeDropdown($event)" />
              Lead
            </label>
          </div>
        </details>

        <div class=" flex gap-2">
          <!-- Botón Buscar -->
          <button type="submit" class="filter-btn" title="Aplicar filtros">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
          </button>
  
          <!-- Botón Limpiar -->
          <button 
            type="button" 
            class="clear-btn" 
            (click)="onClearFilters()" 
            title="Limpiar filtros"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 6h18"></path>
              <path d="M19 6v14c0 1-1 2-2 2H7c0-1-1-2-1-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
          </button>
  
          <!-- Botón de Excel -->
          <button
            type="button"
            class="excel-icon-btn"
            (click)="downloadRequested.emit()"
            [disabled]="isDownloadingExcel"
            aria-label="Descargar Excel"
            title="Descargar Excel"
          >
            <img src="assets/img/excel.png" alt="Excel Icon" class="w-[36px] h-[36px]" />
          </button>
        </div>
    </div>
  </form>
</div>
